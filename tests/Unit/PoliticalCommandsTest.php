<?php

namespace Tests\Unit;

use App\Console\Commands\Political\HourlyProductionReport\HourlyProductionReportRepository;
use App\Mail\Political\PoliticalFlashMail;
use Tests\TestCase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Mail;
use Illuminate\Support\Facades\Notification;
use Maatwebsite\Excel\Facades\Excel;
use Mockery;
use Mockery\MockInterface;

class PoliticalCommandsTest extends TestCase
{
    use RefreshDatabase;
    use WithFaker;

    /** @test */
    public function it_sends_the_political_flash_report()
    {
        Mail::fake();

        $this->artisan('dainsys:political-send-hourly-flash')
            ->expectsOutput('Political Hourly Flash sent!')
            ->assertExitCode(0);

        Mail::assertSent(PoliticalFlashMail::class);
    }

    /** @test */
    public function it_sends_the_hourly_production_report()
    {
        Mail::fake();
        Excel::fake();
        Notification::fake();
        $this->userWithRole('admin');


        // $this->mock(HourlyProductionReportRepository::class, function);;

        $this->mock(HourlyProductionReportRepository::class, function (MockInterface $mock) {
            $mock->shouldReceive('connection')
                ->with('poliscript')
                ->andReturn("Illuminate\Database\Query\Builder");

            $mock->shouldReceive('__construct')
                ->withArgs([
                    'date_from' => '2021-02-01',
                    'date_to' => '2021-02-01'
                ])
                ->andReturn(["asdfasdf"]);
        });

        // $this->artisan('dainsys:political-send-hourly-production-report')
        //     ->expectsOutput('Political Hourly Flash sent!')
        //     ->assertExitCode(0);

        // dd("here");

        // Mail::assertSent(PoliticalFlashMail::class);
    }

    protected function data()
    {
        return json_decode('
            {"data":[{"agent_name":"MYRIAM CASSAMAJOR","dial_group":"POL - NP - SEIUPatch20210127","Team":"SD","Last Name":"CASSAMAJOR","First Name":"MYRIAM","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"0.31366666666666665","work_time":"0.29549999999999998","talk_time":"8.6333333333333331E-2","off_hook_time":"0.31083333333333329","break_time":"0.0","away_time":"0.0","lunch_time":"0.0","training_time":"1.8000000000000002E-2","pending_dispo_time":"0.17699999999999999","time_on_hold":"0.0","engaged_time":"8.0500000000000002E-2","available_time":"0.21133333333333332","total_calls":"15","total_sales":"0","total_contacts":"0"},{"agent_name":"Pedro Camilo Hidalgo Bautista","dial_group":"POL - NP - SEIUPatch20210127","Team":"SD","Last Name":"Hidalgo Bautista","First Name":"Pedro Camilo","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"3.1279999999999997","work_time":"2.8641666666666667","talk_time":"1.7489999999999999","off_hook_time":"2.3066666666666666","break_time":"0.26216666666666666","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.31266666666666665","time_on_hold":"0.0","engaged_time":"1.7060000000000002","available_time":"1.1056666666666666","total_calls":"212","total_sales":"16","total_contacts":"16"},{"agent_name":"Ramon Antonio Lopez Taveras","dial_group":"POL - NP - SEIUPatch20210127","Team":"SD","Last Name":"Lopez Taveras","First Name":"Ramon Antonio","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"3.2433333333333336","work_time":"2.9711666666666665","talk_time":"1.4733333333333334","off_hook_time":"1.9966666666666668","break_time":"0.2545","away_time":"0.0","lunch_time":"0.0","training_time":"1.3333333333333333E-3","pending_dispo_time":"0.85583333333333322","time_on_hold":"0.0","engaged_time":"1.4203333333333332","available_time":"1.508","total_calls":"177","total_sales":"6","total_contacts":"6"},{"agent_name":"Savoit Gilles","dial_group":"POL - NP - SEIUPatch20210127","Team":"SD","Last Name":"Gilles","First Name":"Savoit","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"0.61416666666666664","work_time":"0.61416666666666664","talk_time":"0.31466666666666665","off_hook_time":"0.60199999999999998","break_time":"0.0","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.16133333333333333","time_on_hold":"0.0","engaged_time":"0.30283333333333334","available_time":"0.30316666666666664","total_calls":"32","total_sales":"1","total_contacts":"1"},{"agent_name":"BIENVENIDO NUNEZ NOVA","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"NUNEZ NOVA","First Name":"BIENVENIDO","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"1.8608333333333333","work_time":"1.8516666666666666","talk_time":"0.877","off_hook_time":"2.2083333333333335","break_time":"0.35500000000000004","away_time":"0.0","lunch_time":"0.0","training_time":"3.3333333333333335E-3","pending_dispo_time":"0.33783333333333332","time_on_hold":"0.0","engaged_time":"0.82833333333333337","available_time":"0.99116666666666664","total_calls":"134","total_sales":"18","total_contacts":"59"},{"agent_name":"Danny Emilio Olivares Vasquez","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Olivares Vasquez","First Name":"Danny Emilio","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.1015000000000001","work_time":"2.1019999999999999","talk_time":"0.95316666666666661","off_hook_time":"2.0994999999999999","break_time":"0.0","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.68133333333333335","time_on_hold":"0.0","engaged_time":"0.90583333333333338","available_time":"1.1546666666666667","total_calls":"179","total_sales":"8","total_contacts":"12"},{"agent_name":"Dominic David Jerdes Gonzalez","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Jerdes Gonzalez","First Name":"Dominic David","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.878333333333333","work_time":"2.5796666666666668","talk_time":"1.1588333333333334","off_hook_time":"1.8545","break_time":"0.29799999999999999","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.99083333333333334","time_on_hold":"0.0","engaged_time":"1.1245000000000001","available_time":"1.4161666666666666","total_calls":"180","total_sales":"9","total_contacts":"77"},{"agent_name":"Duany Ramos Lopez","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Ramos Lopez","First Name":"Duany","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.4829999999999997","work_time":"1.9570000000000001","talk_time":"0.96133333333333337","off_hook_time":"2.4775","break_time":"0.31133333333333335","away_time":"0.0","lunch_time":"0.0","training_time":"0.21383333333333335","pending_dispo_time":"0.29049999999999998","time_on_hold":"0.0","engaged_time":"0.90533333333333332","available_time":"1.0070000000000001","total_calls":"212","total_sales":"2","total_contacts":"12"},{"agent_name":"Elvy Garcia","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Garcia","First Name":"Elvy","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.9350000000000001","work_time":"2.9344999999999999","talk_time":"1.2486666666666666","off_hook_time":"2.3228333333333335","break_time":"0.0","away_time":"0.0","lunch_time":"0.0","training_time":"1.1666666666666668E-3","pending_dispo_time":"1.0516666666666667","time_on_hold":"0.0","engaged_time":"1.1996666666666667","available_time":"1.6905000000000001","total_calls":"198","total_sales":"3","total_contacts":"4"},{"agent_name":"Heberto Giordano Gomez Rodriguez","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Gomez Rodriguez","First Name":"Heberto Giordano","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.7090000000000001","work_time":"2.7018333333333335","talk_time":"1.3220000000000001","off_hook_time":"2.4594999999999998","break_time":"0.36199999999999999","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.31966666666666665","time_on_hold":"6.6666666666666671E-3","engaged_time":"1.2661666666666667","available_time":"1.3731666666666666","total_calls":"267","total_sales":"15","total_contacts":"52"},{"agent_name":"Jean Esteban Garcia Vasquez","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Garcia Vasquez","First Name":"Jean Esteban","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"3.0803333333333338","work_time":"2.7643333333333326","talk_time":"1.2276666666666669","off_hook_time":"2.5973333333333333","break_time":"0.0","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.60549999999999993","time_on_hold":"0.0","engaged_time":"1.1593333333333333","available_time":"1.5573333333333337","total_calls":"186","total_sales":"9","total_contacts":"80"},{"agent_name":"MYRIAM CASSAMAJOR","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"CASSAMAJOR","First Name":"MYRIAM","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.7915000000000001","work_time":"2.5036666666666667","talk_time":"0.80783333333333329","off_hook_time":"1.8696666666666666","break_time":"0.27716666666666667","away_time":"0.0","lunch_time":"0.0","training_time":"3.3333333333333335E-3","pending_dispo_time":"1.4506666666666668","time_on_hold":"0.0","engaged_time":"0.76966666666666661","available_time":"1.7061666666666666","total_calls":"122","total_sales":"1","total_contacts":"9"},{"agent_name":"Osse Fortune","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Fortune","First Name":"Osse","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"3.0261666666666667","work_time":"2.7796666666666665","talk_time":"0.73416666666666663","off_hook_time":"1.7663333333333331","break_time":"0.24033333333333334","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"1.1016666666666666","time_on_hold":"0.0","engaged_time":"0.6316666666666666","available_time":"2.0675000000000003","total_calls":"329","total_sales":"5","total_contacts":"61"},{"agent_name":"Ralphy Moran","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Moran","First Name":"Ralphy","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"3.1736666666666671","work_time":"2.8561666666666667","talk_time":"1.1216666666666666","off_hook_time":"2.2686666666666668","break_time":"0.31633333333333336","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.73516666666666663","time_on_hold":"0.0","engaged_time":"1.0566666666666666","available_time":"1.7384999999999999","total_calls":"248","total_sales":"0","total_contacts":"11"},{"agent_name":"Ramon Silvestre Ortiz Bernal","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Ortiz Bernal","First Name":"Ramon Silvestre","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.8374999999999999","work_time":"2.4144999999999999","talk_time":"0.97916666666666663","off_hook_time":"2.7566666666666668","break_time":"0.42283333333333334","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.92766666666666664","time_on_hold":"0.0","engaged_time":"0.92533333333333334","available_time":"1.4501666666666666","total_calls":"196","total_sales":"8","total_contacts":"61"},{"agent_name":"Reginald Deglace","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Deglace","First Name":"Reginald","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.3579999999999997","work_time":"2.3504999999999998","talk_time":"1.0036666666666667","off_hook_time":"2.7791666666666668","break_time":"0.433","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"1.0418333333333334","time_on_hold":"0.0","engaged_time":"0.96333333333333326","available_time":"1.3619999999999999","total_calls":"108","total_sales":"5","total_contacts":"18"},{"agent_name":"Rodolphe Merelus","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Merelus","First Name":"Rodolphe","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"3.0463333333333336","work_time":"2.6905000000000001","talk_time":"1.1161666666666668","off_hook_time":"2.2319999999999998","break_time":"0.35283333333333339","away_time":"0.0","lunch_time":"0.0","training_time":"1.6666666666666668E-3","pending_dispo_time":"0.78449999999999998","time_on_hold":"0.0","engaged_time":"1.0554999999999999","available_time":"1.5778333333333334","total_calls":"265","total_sales":"4","total_contacts":"198"},{"agent_name":"Savoit Gilles","dial_group":"POL - WC - Votga1","Team":"SD","Last Name":"Gilles","First Name":"Savoit","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.246666666666667","work_time":"1.7066666666666668","talk_time":"0.99833333333333329","off_hook_time":"2.2461666666666669","break_time":"0.53999999999999992","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.36749999999999999","time_on_hold":"0.0","engaged_time":"0.97283333333333333","available_time":"0.71616666666666662","total_calls":"73","total_sales":"26","total_contacts":"41"},{"agent_name":"David Stasik","dial_group":"POL - NP - SEIUPatch20210127","Team":"Sunrise","Last Name":"Stasik","First Name":"David","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.6421666666666663","work_time":"2.3981666666666666","talk_time":"0.71949999999999992","off_hook_time":"2.258666666666667","break_time":"0.56333333333333324","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.99399999999999999","time_on_hold":"0.0","engaged_time":"0.64249999999999996","available_time":"1.6941666666666668","total_calls":"254","total_sales":"7","total_contacts":"7"},{"agent_name":"Joy Pysarchyk","dial_group":"POL - NP - SEIUPatch20210127","Team":"Sunrise","Last Name":"Pysarchyk","First Name":"Joy","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"0.3096666666666667","work_time":"0.29999999999999999","talk_time":"0.15083333333333335","off_hook_time":"0.27833333333333332","break_time":"9.6666666666666654E-3","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"9.6666666666666665E-2","time_on_hold":"0.0","engaged_time":"0.14666666666666667","available_time":"0.15083333333333335","total_calls":"12","total_sales":"1","total_contacts":"1"},{"agent_name":"Keith Crosby","dial_group":"POL - NP - SEIUPatch20210127","Team":"Sunrise","Last Name":"Crosby","First Name":"Keith","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"8.2000000000000003E-2","work_time":"8.2166666666666666E-2","talk_time":"4.2833333333333327E-2","off_hook_time":"8.1666666666666679E-2","break_time":"0.0","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"1.3333333333333334E-2","time_on_hold":"0.0","engaged_time":"4.1333333333333333E-2","available_time":"3.9666666666666663E-2","total_calls":"4","total_sales":"1","total_contacts":"1"},{"agent_name":"Laura Ritter","dial_group":"POL - NP - SEIUPatch20210127","Team":"Sunrise","Last Name":"Ritter","First Name":"Laura","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"2.934166666666667","work_time":"2.6724999999999999","talk_time":"1.5596666666666665","off_hook_time":"1.9808333333333332","break_time":"0.2545","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"0.45133333333333331","time_on_hold":"0.0","engaged_time":"1.5088333333333332","available_time":"1.1211666666666666","total_calls":"198","total_sales":"36","total_contacts":"36"},{"agent_name":"Marlene Dietrich","dial_group":"POL - NP - SEIUPatch20210127","Team":"Sunrise","Last Name":"Dietrich","First Name":"Marlene","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"0.38500000000000001","work_time":"0.35283333333333339","talk_time":"0.18216666666666667","off_hook_time":"0.35249999999999998","break_time":"3.2166666666666663E-2","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"9.1999999999999998E-2","time_on_hold":"0.0","engaged_time":"0.17549999999999999","available_time":"0.17283333333333331","total_calls":"19","total_sales":"2","total_contacts":"2"},{"agent_name":"Phyliss Rolle","dial_group":"POL - NP - SEIUPatch20210127","Team":"Sunrise","Last Name":"Rolle","First Name":"Phyliss","date_from":"2021-02-05","date_to":"2021-02-05","login_time":"0.22066666666666668","work_time":"0.217","talk_time":"0.09583333333333334","off_hook_time":"0.20299999999999999","break_time":"3.8333333333333336E-3","away_time":"0.0","lunch_time":"0.0","training_time":"0.0","pending_dispo_time":"9.3833333333333338E-2","time_on_hold":"0.0","engaged_time":"9.2499999999999999E-2","available_time":"0.12233333333333334","total_calls":"9","total_sales":"2","total_contacts":"2"}]}
        ');
    }
}
